{% extends 'base.html.twig' %}

{% block title %}Carte des structures{% endblock %}

{% block body %}
    <h1>
        <picto class="structure-picto"></picto>
        Carte des Structures
    </h1>
    <p class="text-end">
        <a href="{{ path('app_carte_artiste') }}" class="btn btn-primary btn-sm mb-3">Voir la carte des artistes</a>
    </p>
    <div id="map"></div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css"/>

    <script type="module">

        document.addEventListener("DOMContentLoaded", function (event) {

            var icon = L.icon({iconUrl: '/marker-icon.png', iconSize: [25, 41], iconAnchor: [12, 41]});
            var map = L.map('map').setView([46.65, -0.35], 7);

            L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);


            var markers = L.markerClusterGroup({ disableClusteringAtZoom: 13});

            {% for structure in structures %}
            {% if structure.latitude or structure.longitude %}

            var marker = L.marker([{{ structure.latitude }}, {{ structure.longitude }}], {icon: icon})

            marker.bindPopup('{{ structure }}<br> {{ structure.codePostal }} {{ structure.commune }}<br/><br/>' +
                '<ul>{% for tag in structure.tags %}<li>{{ tag }}</li>{% endfor %}</ul>',
                {
                    offset: L.point(0, -20)
                })
            markers.addLayer(marker);


            {% endif %}
            {% endfor %}


            map.addLayer(markers);
            setTimeout(function () {
                map.invalidateSize();
            }, 500);
        });
    </script>
{% endblock %}